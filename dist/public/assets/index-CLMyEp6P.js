import{c as Y,r as c,j as e,q as x,ae as Z,C as ee,x as ae,af as se,$ as te,M as U,N as V,O as $,Q as q,T as z,V as i,B as ne,R as re}from"./index-B3yLkj_P.js";import{T as ie,a as le,b as ce,c as S,d as h,e as oe,f as o}from"./table-DbxJySh8.js";import{C as de}from"./chevron-left-BV6FuCAx.js";import{B as l}from"./badge-4B3PkiTv.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=Y("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),D=({className:r,...n})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:x("mx-auto flex w-full justify-center",r),...n});D.displayName="Pagination";const H=c.forwardRef(({className:r,...n},d)=>e.jsx("ul",{ref:d,className:x("flex flex-row items-center gap-1",r),...n}));H.displayName="PaginationContent";const b=c.forwardRef(({className:r,...n},d)=>e.jsx("li",{ref:d,className:x("",r),...n}));b.displayName="PaginationItem";const P=({className:r,isActive:n,size:d="icon",...k})=>e.jsx("a",{"aria-current":n?"page":void 0,className:x(Z({variant:n?"outline":"ghost",size:d}),r),...k});P.displayName="PaginationLink";const G=({className:r,...n})=>e.jsxs(P,{"aria-label":"Go to previous page",size:"default",className:x("gap-1 pl-2.5",r),...n,children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});G.displayName="PaginationPrevious";const O=({className:r,...n})=>e.jsxs(P,{"aria-label":"Go to next page",size:"default",className:x("gap-1 pr-2.5",r),...n,children:[e.jsx("span",{children:"Next"}),e.jsx(ee,{className:"h-4 w-4"})]});O.displayName="PaginationNext";const Q=({className:r,...n})=>e.jsxs("span",{"aria-hidden":!0,className:x("flex h-9 w-9 items-center justify-center",r),...n,children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});Q.displayName="PaginationEllipsis";const ue=()=>{const[,r]=ae(),{isAdminAuthenticated:n}=se(),[d,k]=c.useState([]),[A,C]=c.useState(!0),[L,T]=c.useState(null),[t,p]=c.useState({page:1,limit:10,total:0,pages:0}),[m,E]=c.useState("all"),[j,R]=c.useState("all"),[v,F]=c.useState(""),J=async()=>{var a;C(!0),T(null);try{console.log("Fetching tickets with pagination:",t.page,t.limit),console.log("Filters:",{status:m,priority:j,search:v});const s=localStorage.getItem("adminToken");if(!s)throw new Error("Admin authentication required. Please log in again.");const g=new URLSearchParams;g.append("page",t.page.toString()),g.append("limit",t.limit.toString()),m&&m!=="all"&&g.append("status",m),j&&j!=="all"&&g.append("priority",j),v&&g.append("search",v);const I=`/api/admin/tickets?${g.toString()}`;console.log("Request URL:",I);const y=await fetch(I,{credentials:"include",headers:{Accept:"application/json",Authorization:`Bearer ${s}`}});if(console.log("Response status:",y.status),!y.ok){const f=await y.text();console.error("Error response:",f);let u="Failed to fetch tickets";try{const N=JSON.parse(f);N.message&&(u=N.message)}catch{f&&(u=f)}throw y.status===401&&(localStorage.removeItem("adminToken"),u="Authentication expired. Please log in again."),new Error(u)}const w=await y.json();console.log("Received data:",w),console.log(`Loaded ${((a=w.tickets)==null?void 0:a.length)||0} tickets`),k(w.tickets||[]),p(f=>{var u,N;return{...f,total:((u=w.pagination)==null?void 0:u.total)||0,pages:((N=w.pagination)==null?void 0:N.pages)||0}})}catch(s){console.error("Fetch error:",s),T(s instanceof Error?s.message:"An error occurred")}finally{C(!1)}};c.useEffect(()=>{n?J():(T("Admin authentication required to view tickets."),C(!1))},[t.page,m,j,v,n]);const _=a=>{r(`/admin-dashboard/tickets/${a}`)},M=()=>{p(a=>({...a,page:1}))},K=()=>{E("all"),R("all"),F(""),p(a=>({...a,page:1}))},W=a=>{switch(a){case"new":return e.jsx(l,{variant:"outline",className:"bg-blue-100 text-blue-800",children:"New"});case"processing":return e.jsx(l,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"Processing"});case"completed":return e.jsx(l,{variant:"outline",className:"bg-green-100 text-green-800",children:"Completed"});case"rejected":return e.jsx(l,{variant:"outline",className:"bg-red-100 text-red-800",children:"Rejected"});default:return e.jsx(l,{variant:"outline",children:a})}},X=a=>{switch(a){case"low":return e.jsx(l,{variant:"outline",className:"bg-gray-100 text-gray-800",children:"Low"});case"medium":return e.jsx(l,{variant:"outline",className:"bg-blue-100 text-blue-800",children:"Medium"});case"high":return e.jsx(l,{variant:"outline",className:"bg-orange-100 text-orange-800",children:"High"});case"urgent":return e.jsx(l,{variant:"outline",className:"bg-red-100 text-red-800",children:"Urgent"});default:return e.jsx(l,{variant:"outline",children:a})}},B=a=>{const s=new Date(a);return s.toLocaleDateString()+" "+s.toLocaleTimeString()};return e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Ticket Management"}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx(te,{placeholder:"Search tickets...",value:v,onChange:a=>F(a.target.value),className:"w-full"})}),e.jsx("div",{className:"w-[150px]",children:e.jsxs(U,{value:m,onValueChange:a=>{E(a),M()},children:[e.jsx(V,{children:e.jsx($,{placeholder:"Status"})}),e.jsx(q,{children:e.jsxs(z,{children:[e.jsx(i,{value:"all",children:"All Statuses"}),e.jsx(i,{value:"new",children:"New"}),e.jsx(i,{value:"processing",children:"Processing"}),e.jsx(i,{value:"completed",children:"Completed"}),e.jsx(i,{value:"rejected",children:"Rejected"})]})})]})}),e.jsx("div",{className:"w-[150px]",children:e.jsxs(U,{value:j,onValueChange:a=>{R(a),M()},children:[e.jsx(V,{children:e.jsx($,{placeholder:"Priority"})}),e.jsx(q,{children:e.jsxs(z,{children:[e.jsx(i,{value:"all",children:"All Priorities"}),e.jsx(i,{value:"low",children:"Low"}),e.jsx(i,{value:"medium",children:"Medium"}),e.jsx(i,{value:"high",children:"High"}),e.jsx(i,{value:"urgent",children:"Urgent"})]})})]})}),e.jsx(ne,{variant:"outline",onClick:K,children:"Clear Filters"})]}),L&&e.jsxs("div",{className:"bg-red-100 text-red-800 p-4 rounded-lg mb-6",children:["Error: ",L]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ie,{children:[e.jsx(le,{children:"List of all user tickets"}),e.jsx(ce,{children:e.jsxs(S,{children:[e.jsx(h,{className:"w-[100px]",children:"Ticket ID"}),e.jsx(h,{children:"Title"}),e.jsx(h,{children:"Service"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Priority"}),e.jsx(h,{children:"Created"}),e.jsx(h,{children:"Last Updated"})]})}),e.jsx(oe,{children:A?e.jsx(S,{children:e.jsx(o,{colSpan:7,className:"text-center py-10",children:"Loading tickets..."})}):d.length===0?e.jsx(S,{children:e.jsx(o,{colSpan:7,className:"text-center py-10",children:"No tickets found."})}):d.map(a=>e.jsxs(S,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>_(a.id),children:[e.jsxs(o,{className:"font-medium",children:[a.id.substring(0,8),"..."]}),e.jsx(o,{children:a.title}),e.jsx(o,{children:a.serviceName}),e.jsx(o,{children:W(a.status)}),e.jsx(o,{children:X(a.priority)}),e.jsx(o,{children:B(a.createdAt)}),e.jsx(o,{children:B(a.updatedAt)})]},a.id))})]})}),!A&&t.pages>1&&e.jsx(D,{className:"mt-6",children:e.jsxs(H,{children:[e.jsx(b,{children:e.jsx(G,{onClick:()=>p(a=>({...a,page:Math.max(1,a.page-1)})),className:t.page<=1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:t.pages}).map((a,s)=>s===0||s===t.pages-1||s>=t.page-2&&s<=t.page+2?e.jsx(b,{children:e.jsx(P,{onClick:()=>p(g=>({...g,page:s+1})),isActive:t.page===s+1,children:s+1})},s):s===1&&t.page>4||s===t.pages-2&&t.page<t.pages-3?e.jsx(b,{children:e.jsx(Q,{})},s):null),e.jsx(b,{children:e.jsx(O,{onClick:()=>p(a=>({...a,page:Math.min(a.pages,a.page+1)})),className:t.page>=t.pages?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})},je=()=>(re.useEffect(()=>(document.title="Admin Ticket Management",()=>{}),[]),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx(ue,{})}));export{je as default};
