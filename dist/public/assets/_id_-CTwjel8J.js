import{c as S,j as e,q,z as I,I as A,J as P,D as _,r as u,a as g,b as j,K as k,M as E,N as F,O as V,Q as W,T as z,V as w,B as L,v as H,w as O,W as Q,H as B,g as T,X as U,Y as K,x as R,y as $,Z as X,_ as G,C as J}from"./index-B3yLkj_P.js";import{B as c}from"./badge-4B3PkiTv.js";import{T as Y,a as Z,b as D}from"./tabs-C-rN83Db.js";import{C as ee,a as se}from"./circle-x-C5jAzUdU.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=S("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=S("CircleEllipsis",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M17 12h.01",key:"1m0b6t"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M7 12h.01",key:"eqddd0"}]]);function p({className:t,...a}){return e.jsx("div",{className:q("animate-pulse rounded-md bg-muted",t),...a})}function M(t){const{user:a}=I(),{data:i=[],isLoading:x,error:l,refetch:r}=A({queryKey:[`/api/tickets/${t}/tasks`],queryFn:P({on401:"returnNull"}),enabled:!!a&&!!t,staleTime:2*60*1e3});return{tasks:i,isLoading:x,error:l,refetchTasks:r}}function re({ticketId:t}){const{tasks:a,isLoading:i,error:x}=M(t),{markTaskSeen:l}=_(),[r,d]=u.useState("createdAt"),[f,N]=u.useState("desc");u.useEffect(()=>{a&&a.length>0&&a.forEach(s=>{l(s.id)})},[a,l]);const h=s=>new Date(s).toLocaleDateString(),y=s=>{switch(s.status){case"pending":return e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:"Pending"})]});case"in_progress":return e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:"In Progress"})]});case"completed":return e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{children:"Completed"})]});default:return e.jsx("div",{className:"flex items-center gap-2 text-gray-600",children:e.jsx("span",{children:s.status})})}},n=s=>{const m=new Date,v=new Date(s).getTime()-m.getTime(),C=Math.ceil(v/(1e3*3600*24));return C<0?e.jsxs("span",{className:"text-red-600",children:[h(s)," (Overdue)"]}):C<=3?e.jsxs("span",{className:"text-orange-600",children:[h(s)," (Soon)"]}):e.jsx("span",{className:"text-gray-600",children:h(s)})},b=[...a].sort((s,m)=>{let o=0;switch(r){case"dueDate":o=new Date(s.dueDate).getTime()-new Date(m.dueDate).getTime();break;case"createdAt":o=new Date(s.createdAt).getTime()-new Date(m.createdAt).getTime();break;case"status":const v={completed:3,in_progress:2,pending:1};o=v[s.status]-v[m.status];break;case"title":o=s.title.localeCompare(m.title);break;default:o=0}return f==="asc"?o:-o});return i?e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{className:"h-[120px] w-full rounded-lg"}),e.jsx(p,{className:"h-[120px] w-full rounded-lg"}),e.jsx(p,{className:"h-[120px] w-full rounded-lg"})]}):x?e.jsx(g,{className:"border-2 border-red-300 bg-red-50",children:e.jsx(j,{className:"pt-6",children:e.jsx("p",{className:"text-red-700",children:"There was a problem loading the tasks for this ticket. Please try refreshing the page."})})}):a.length===0?e.jsx(g,{className:"border-2 border-gray-300",children:e.jsx(j,{className:"pt-6 pb-6 text-center",children:e.jsxs("p",{className:"text-muted-foreground",children:["Welcome to Claimsutra,",e.jsx("br",{}),e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"rounded-full bg-blue-600 p-1 flex items-center justify-center",children:e.jsx(k,{className:"h-3 w-3 text-white"})}),"India's No. 1 Platform for All Things Legal."]}),e.jsx("br",{}),"Please wait a moment while our legal expert connects with you shortly."]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Tasks for this ticket"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(E,{value:r,onValueChange:s=>d(s),children:[e.jsx(F,{className:"w-[180px]",children:e.jsx(V,{placeholder:"Sort by"})}),e.jsx(W,{children:e.jsxs(z,{children:[e.jsx(w,{value:"dueDate",children:"Due Date"}),e.jsx(w,{value:"createdAt",children:"Created Date"}),e.jsx(w,{value:"status",children:"Status"}),e.jsx(w,{value:"title",children:"Title"})]})})]}),e.jsx(L,{variant:"outline",size:"icon",onClick:()=>N(s=>s==="asc"?"desc":"asc"),className:"h-9 w-9",children:e.jsx(te,{className:"h-4 w-4"})})]})]}),b.map(s=>e.jsxs(g,{className:`overflow-hidden border-2 shadow-sm ${s.status==="completed"?"border-green-400 bg-green-50":s.status==="in_progress"?"border-blue-400 bg-blue-50/30":"border-gray-300"}`,children:[e.jsxs(H,{className:"p-4 pb-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(O,{className:"text-lg",children:s.title}),e.jsx(c,{variant:s.status==="completed"?"secondary":s.status==="in_progress"?"default":"outline",children:s.status.replace("_"," ")})]}),e.jsxs(Q,{className:"text-sm flex justify-between items-center mt-1",children:[e.jsxs("span",{children:["Assigned to: ",s.assigneeName||"Customer Support"]}),e.jsxs("span",{className:"font-medium",children:["Due: ",n(s.dueDate)]})]})]}),e.jsxs(j,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-muted-foreground",children:[e.jsx("div",{children:y(s)}),e.jsxs("div",{children:["Created: ",h(s.createdAt)]})]})]})]},s.id))]})}function ne({tasks:t}){if(!t||t.length===0)return null;const a=t.length,i=t.filter(d=>d.status==="completed").length,x=t.filter(d=>d.status==="in_progress").length,l=t.filter(d=>d.status==="pending").length,r=Math.round(i/a*100);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Task Progress"}),e.jsxs("span",{className:"text-sm font-medium",children:[r,"% Complete"]})]}),e.jsx(U,{value:r,className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3 text-green-500"}),e.jsxs("span",{children:[i," Completed"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3 text-blue-500"}),e.jsxs("span",{children:[x," In Progress"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3 text-gray-500"}),e.jsxs("span",{children:[l," Pending"]})]})]})]})}function oe(){const{id:t}=K(),[,a]=R(),[i,x]=u.useState("tasks"),{tasks:l}=M(t);$(),X();const{data:r,isLoading:d,error:f}=A({queryKey:[`/api/tickets/${t}`],queryFn:P({on401:"returnNull"}),enabled:!!t,staleTime:5*60*1e3});u.useEffect(()=>{f&&a("/tickets")},[f,a]);const N=n=>{if(!n)return"";const b=new Date(n);return b.toLocaleDateString()+" "+b.toLocaleTimeString()},h=n=>{if(!n)return null;switch(n){case"new":return e.jsxs(c,{variant:"outline",className:"bg-blue-100 text-blue-800 border-blue-200 flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3"}),e.jsx("span",{children:"New"})]});case"processing":return e.jsxs(c,{variant:"outline",className:"bg-yellow-100 text-yellow-800 border-yellow-200 flex items-center gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),e.jsx("span",{children:"Processing"})]});case"completed":return e.jsxs(c,{variant:"outline",className:"bg-green-100 text-green-800 border-green-200 flex items-center gap-1",children:[e.jsx(se,{className:"h-3 w-3"}),e.jsx("span",{children:"Completed"})]});case"rejected":return e.jsxs(c,{variant:"outline",className:"bg-red-100 text-red-800 border-red-200 flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),e.jsx("span",{children:"Rejected"})]});default:return e.jsx(c,{children:n})}},y=n=>{if(!n)return null;switch(n){case"low":return e.jsx(c,{variant:"outline",className:"bg-gray-100 text-gray-800 border-gray-200",children:"Low Priority"});case"medium":return e.jsx(c,{variant:"outline",className:"bg-blue-100 text-blue-800 border-blue-200",children:"Medium Priority"});case"high":return e.jsx(c,{variant:"outline",className:"bg-orange-100 text-orange-800 border-orange-200",children:"High Priority"});case"urgent":return e.jsx(c,{variant:"outline",className:"bg-red-100 text-red-800 border-red-200",children:"Urgent"});default:return null}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(G,{href:"/tickets",children:e.jsxs("button",{className:"text-lg font-semibold flex items-center mb-4",children:[e.jsx(J,{className:"w-5 h-5 rotate-180"})," Back to Tickets"]})}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{className:"h-[180px] w-full rounded-lg"}),e.jsx(p,{className:"h-[300px] w-full rounded-lg"})]}):r?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mb-6",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-semibold",children:r.title||r.serviceName})}),e.jsx("div",{className:"flex flex-col gap-2 items-end",children:e.jsxs("div",{className:"flex gap-2",children:[h(r.status),y(r.priority)]})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Created:"})," ",N(r.createdAt)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Updated:"})," ",N(r.updatedAt)]})]}),l&&l.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(ne,{tasks:l})})]}),e.jsx(Y,{defaultValue:"tasks",onValueChange:x,children:e.jsxs(Z,{className:"grid grid-cols-2 mt-4",children:[e.jsx(D,{value:"tasks",children:"Tasks"}),e.jsx(D,{value:"whatsapp",children:"WhatsApp Chat"})]})})]})}),e.jsxs("div",{className:"mb-8",children:[i==="tasks"&&e.jsx(re,{ticketId:t}),i==="whatsapp"&&e.jsx(g,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-green-500 mb-4",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"})})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Chat on WhatsApp"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Have questions about your ticket? Chat with our support team on WhatsApp for quick assistance."}),e.jsxs("a",{href:"https://wa.me/918630959445",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors duration-200",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"})}),"Start WhatsApp Chat"]})]})})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Ticket not found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The ticket you are looking for doesn't exist or you don't have permission to view it."}),e.jsx(L,{onClick:()=>a("/tickets"),children:"Back to Tickets"})]})]})}export{oe as default};
