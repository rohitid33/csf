import{c as h,r as x,x as k,y as L,z as D,D as B,j as e,B as l,L as R,a as z,b as U,E as $,C as M,H as O,g as P}from"./index-B3yLkj_P.js";import{B as n}from"./badge-4B3PkiTv.js";import{C as q,a as E}from"./circle-x-C5jAzUdU.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=h("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=h("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=h("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);function X(){const[t,u]=x.useState("ongoing"),[,p]=k(),{tickets:d,isLoading:a,error:m}=L();D();const{getUnseenTaskCountForTicket:N}=B(),[c,y]=x.useState(""),[i,v]=x.useState("desc"),C=()=>{v(i==="desc"?"asc":"desc")},o=a?[]:d.filter(s=>{const r=c===""||s.title&&s.title.toLowerCase().includes(c.toLowerCase())||s.serviceName.toLowerCase().includes(c.toLowerCase());return t==="ongoing"?(s.status==="new"||s.status==="processing")&&r:t==="completed"?s.status==="completed"&&r:r}).map(s=>{var r;return{...s,description:(r=s.description)==null?void 0:r.replace(/^Request for .* service\./i,"").trim()}}).sort((s,r)=>{const f=new Date(s.createdAt).getTime(),b=new Date(r.createdAt).getTime();return i==="asc"?f-b:b-f}),g=a?0:d.filter(s=>s.status==="new"||s.status==="processing").length,j=a?0:d.filter(s=>s.status==="completed").length,T=s=>{switch(s){case"new":return e.jsxs(n,{className:"bg-blue-100 text-blue-800 border-blue-200 flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),e.jsx("span",{children:"New"})]});case"processing":return e.jsxs(n,{className:"bg-yellow-100 text-yellow-800 border-yellow-200 flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3"}),e.jsx("span",{children:"In Progress"})]});case"completed":return e.jsxs(n,{className:"bg-green-100 text-green-800 border-green-200 flex items-center gap-1",children:[e.jsx(E,{className:"h-3 w-3"}),e.jsx("span",{children:"Completed"})]});case"rejected":return e.jsxs(n,{className:"bg-red-100 text-red-800 border-red-200 flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{children:"Rejected"})]});default:return e.jsx(n,{children:s})}},S=s=>{if(!s)return null;switch(s){case"high":return e.jsxs("div",{className:"flex items-center text-orange-600 text-sm font-medium",children:[e.jsx(w,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:"High Priority"})]});case"urgent":return e.jsxs("div",{className:"flex items-center text-red-600 text-sm font-medium",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:"Urgent"})]});default:return null}},A=s=>new Date(s).toLocaleDateString();return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"My Tickets"}),e.jsxs("div",{className:"flex items-center justify-between mb-6 gap-4",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{type:"search",placeholder:"Search tickets...",className:"w-full p-2 rounded-md border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none transition-all",value:c,onChange:s=>y(s.target.value)})}),e.jsxs(l,{variant:"outline",onClick:C,className:"flex items-center gap-1 min-w-[130px] border border-gray-300 hover:border-primary hover:bg-primary/5 shadow-sm",children:[e.jsxs("span",{children:["Sort: ",i==="desc"?"Newest":"Oldest"]}),i==="desc"?e.jsx(I,{className:"h-4 w-4"}):e.jsx(w,{className:"h-4 w-4"})]})]}),e.jsxs("div",{className:"flex space-x-8 border-b border-gray-200 mb-6 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>u("ongoing"),className:`pb-4 px-1 capitalize whitespace-nowrap transition-all ${t==="ongoing"?"border-b-3 border-primary font-semibold text-primary":"text-muted-foreground hover:text-gray-700"}`,children:["Ongoing ",g>0&&`(${g})`]}),e.jsxs("button",{onClick:()=>u("completed"),className:`pb-4 px-1 capitalize whitespace-nowrap transition-all ${t==="completed"?"border-b-3 border-primary font-semibold text-primary":"text-muted-foreground hover:text-gray-700"}`,children:["Completed ",j>0&&`(${j})`]})]}),a&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(R,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading your tickets..."})]}),m&&e.jsxs("div",{className:"bg-red-50 border border-red-300 rounded-md p-4 text-center",children:[e.jsx("p",{className:"text-red-700",children:"There was a problem loading your tickets. Please try again."}),e.jsx(l,{variant:"outline",className:"mt-2",onClick:()=>window.location.reload(),children:"Retry"})]}),!a&&!m&&o.length===0&&e.jsxs("div",{className:"text-center py-12 border border-gray-300 rounded-md",children:[e.jsx("h3",{className:"text-xl font-medium mb-2",children:"No tickets found"}),t==="ongoing"?e.jsx("p",{className:"text-muted-foreground mb-4",children:"You don't have any ongoing tickets. Try adjusting your search or sort criteria."}):e.jsxs("p",{className:"text-muted-foreground mb-4",children:["You don't have any ",t," tickets. Try adjusting your search or sort criteria."]}),e.jsx(l,{variant:"outline",className:"w-full",onClick:()=>p("/gogo"),children:"Browse Services"})]}),!a&&!m&&o.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[o.length," ticket",o.length!==1?"s":""," found"]}),e.jsxs("span",{className:"flex items-center gap-1",children:["Sorted by date: ",i==="desc"?"newest first":"oldest first"]})]}),o.map(s=>{const r=N(s.id);return e.jsx("div",{onClick:()=>p(`/ticket/${s.id}`),className:"block mb-4 transform transition-all duration-200 hover:translate-y-[-2px]",children:e.jsx(z,{className:`cursor-pointer hover:shadow-lg transition-all border ${s.priority==="urgent"?"border-red-400":s.priority==="high"?"border-orange-400":"border-gray-300 hover:border-primary/60"}`,children:e.jsxs(U,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.title||s.serviceName}),r>0&&e.jsxs(n,{variant:"secondary",className:"bg-primary/10 text-primary flex items-center gap-1",children:[e.jsx($,{className:"h-3 w-3"}),r," new ",r===1?"task":"tasks"]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:!s.title&&s.serviceName}),e.jsx("div",{className:"text-sm text-muted-foreground flex gap-3 mt-1",children:e.jsxs("span",{children:["Created: ",A(s.createdAt)]})}),s.description&&e.jsx("p",{className:"text-sm mt-2 line-clamp-2",children:s.description})]}),e.jsx(M,{className:"w-5 h-5"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[T(s.status),S(s.priority)]}),e.jsxs("div",{children:[(s.status==="new"||s.status==="processing")&&e.jsx(l,{size:"sm",className:"min-w-[110px]",children:"View Details"}),(s.status==="completed"||s.status==="rejected")&&e.jsx(l,{size:"sm",variant:"outline",className:"min-w-[110px]",children:"View Details"})]})]})]})})},s.id)})]})]})}export{X as default};
