import{r as u,a5 as xe,a0 as Ge,j as e,P as Ae,q as Ne,a as Z,v as ve,w as ye,b as ee,a8 as N,$ as B,a9 as We,B as I,h as Ye,u as Ze,a1 as es,l as Pe,k as ss,aa as ts,ab as as,K as rs,M as $e,N as Re,O as qe,Q as Oe,V as Be,ac as ge,ad as is}from"./index-B3yLkj_P.js";import{T as Le,a as ze,b as G,c as W}from"./tabs-C-rN83Db.js";import{B as Ce}from"./badge-4B3PkiTv.js";function os(){const[s,a]=u.useState([]),[r,t]=u.useState(""),[i,n]=u.useState(""),[c,o]=u.useState(0),[l,j]=u.useState([]),[g,v]=u.useState(null),[h,S]=u.useState(!1),[b,w]=u.useState(!1),{toast:p}=xe();return{categories:s,categoryName:r,setCategoryName:t,categoryIcon:i,setCategoryIcon:n,categoryNumber:c,setCategoryNumber:o,categoryTags:l,setCategoryTags:j,editCategoryId:g,setEditCategoryId:v,isLoading:h,hasChanges:b,setHasChanges:w,fetchCategories:async()=>{S(!0);try{const d=await fetch("/api/categories");if(!d.ok)throw new Error("Failed to fetch categories");const A=(await d.json()).map(E=>({id:E.id,name:E.name,icon:E.icon||"ðŸ“„",number:E.number||0,tags:Array.isArray(E.tags)?E.tags:[]}));a(A)}catch(d){console.error("Error fetching categories:",d),p({title:"Error",description:"Failed to load categories",variant:"destructive"})}finally{S(!1)}},handleAddCategory:async()=>{if(!r.trim()){p({title:"Error",description:"Category name is required",variant:"destructive"});return}S(!0);try{const d={name:r,icon:i,number:c,tags:l};let x;if(g?x=await fetch(`/api/categories/${g}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}):x=await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),!x.ok){const E=await x.json();throw new Error(E.error||"Failed to save category")}const A=await x.json();g?(a(s.map(E=>E.id===g?A:E)),v(null)):a([...s,A]),t(""),n(""),o(0),j([]),p({title:g?"Category updated":"Category added",description:`The category has been ${g?"updated":"added"} successfully.`})}catch(d){console.error("Error saving category:",d),p({title:"Error",description:d instanceof Error?d.message:"Failed to save category",variant:"destructive"})}finally{S(!1)}},handleDeleteCategory:d=>{window.confirm("Are you sure you want to delete this category?")&&(a(s.filter(x=>x.id!==d)),w(!0),p({title:"Category deleted",description:"The category has been deleted from the local changes."}))}}}const $=[{id:"health-insurance",name:"Health Insurance",categoryId:"insurance",serviceIds:["health-claim"]},{id:"motor-insurance",name:"Motor Insurance",categoryId:"insurance",serviceIds:["motor-claim"]},{id:"life-insurance",name:"Life Insurance",categoryId:"insurance",serviceIds:["life-claim"]}];let ns=[];async function cs(){try{console.log("Fetching subcategories from API...");const s=await fetch("/api/subcategories");if(s.ok){const a=await s.json();return console.log("Subcategories fetched successfully:",a),$.length=0,$.push(...a),je(),console.log("Subcategories fetched from API:",a.length),[...a]}else return console.warn("Failed to fetch subcategories from API, using local data"),[...$]}catch(s){return console.error("Error fetching subcategories from API:",s),[...$]}}async function Me(s){try{console.log("Updating subcategories data:",s),$.length=0,$.push(...s),je();const a=localStorage.getItem("adminToken");if(!a)throw new Error("Admin authentication required");const r=s.map(async t=>{try{try{if((await fetch(`/api/subcategories/${t.id}`)).ok){if(console.log(`Updating subcategory ${t.id} in MongoDB via admin API`),(await fetch(`/api/admin/subcategories/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t),credentials:"include"})).ok)return}else if(console.log(`Creating new subcategory ${t.id} in MongoDB via admin API`),(await fetch("/api/admin/subcategories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t),credentials:"include"})).ok)return}catch(n){console.warn(`Failed to update subcategory ${t.id} via admin API, falling back to regular API:`,n)}return(await fetch(`/api/subcategories/${t.id}`)).ok?(console.log(`Updating subcategory ${t.id} in MongoDB`),fetch(`/api/subcategories/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t),credentials:"include"})):(console.log(`Creating new subcategory ${t.id} in MongoDB`),fetch("/api/subcategories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t),credentials:"include"}))}catch(i){throw console.error(`Failed to update subcategory ${t.id}:`,i),i}});await Promise.all(r),console.log("All subcategories synced with MongoDB successfully"),pe()}catch(a){throw console.error("Failed to update subcategories in the database:",a),a}}async function ls(s){try{if(console.log("=== Creating subcategory ==="),console.log("New subcategory data:",s),$.some(t=>t.id===s.id))throw new Error(`Subcategory with ID ${s.id} already exists`);$.push(s),je();const a=localStorage.getItem("adminToken");if(console.log("Admin token present:",!!a),!a)throw new Error("Admin authentication required");console.log("Sending request to create subcategory...");try{const t=await fetch("/api/admin/subcategories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({id:s.id,name:s.name,categoryId:s.categoryId,serviceIds:s.serviceIds||[]}),credentials:"include"});if(t.ok){const i=await t.json();console.log("Response data from admin API:",i),console.log(`Subcategory ${s.id} created in MongoDB successfully via admin API`),pe();return}}catch(t){console.warn("Failed to create subcategory via admin API, falling back to regular API:",t)}const r=await fetch("/api/subcategories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({id:s.id,name:s.name,categoryId:s.categoryId,serviceIds:s.serviceIds||[]}),credentials:"include"});if(console.log("Response status:",r.status),r.ok){const t=await r.json();console.log("Response data:",t),console.log(`Subcategory ${s.id} created in MongoDB successfully`)}else{const t=await r.json();throw console.error("Error response:",t),new Error(t.error||t.message||"Failed to create subcategory in MongoDB")}pe()}catch(a){throw console.error(`Failed to create subcategory ${s.id}:`,a),a}}async function ds(s){try{console.log(`Deleting subcategory with ID: ${s}`);const a=$.findIndex(i=>i.id===s);if(a===-1)return console.warn(`Subcategory with ID ${s} not found in local data`),!1;$.splice(a,1),je();const r=localStorage.getItem("adminToken");if(!r)throw new Error("Admin authentication required");try{const i=await fetch(`/api/admin/subcategories/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`},credentials:"include"});if(i.ok||i.status===404)return console.log(`Subcategory ${s} deleted successfully via admin API`),pe(),!0}catch(i){console.warn("Failed to delete subcategory via admin API, falling back to regular API:",i)}const t=await fetch(`/api/subcategories/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`},credentials:"include"});if(!t.ok&&t.status!==404){const i=await t.json().catch(()=>({}));throw console.error("Error response:",i),new Error(i.error||i.message||`Failed to delete subcategory ${s}`)}return console.log(`Subcategory ${s} deleted successfully`),pe(),!0}catch(a){throw console.error(`Error deleting subcategory ${s}:`,a),a}}function pe(){ns.forEach(s=>s())}function je(){try{localStorage.setItem("subcategories",JSON.stringify($))}catch(s){console.error("Failed to save subcategories to localStorage:",s)}}try{const s=localStorage.getItem("subcategories");if(s){const a=JSON.parse(s);$.length=0,$.push(...a)}}catch(s){console.error("Failed to load subcategories from localStorage:",s)}function us(){const[s,a]=u.useState([]),[r,t]=u.useState(""),[i,n]=u.useState(""),[c,o]=u.useState([]),[l,j]=u.useState(null),[g,v]=u.useState(!1),[h,S]=u.useState(!1),{toast:b}=xe();u.useEffect(()=>{w()},[]);const w=async()=>{v(!0);try{console.log("Fetching subcategories from API...");const d=await cs();console.log("Fetched subcategories:",d),a(d)}catch(d){console.error("Error loading subcategories:",d),b({title:"Error loading subcategories",description:"There was a problem loading the subcategories.",variant:"destructive"})}finally{v(!1)}};return{subcategories:s,setSubcategories:a,subcategoryName:r,setSubcategoryName:t,selectedCategoryForSubcategory:i,setSelectedCategoryForSubcategory:n,selectedServicesForSubcategory:c,setSelectedServicesForSubcategory:o,editSubcategoryId:l,setEditSubcategoryId:j,isLoading:g,hasChanges:h,setHasChanges:S,fetchSubcategories:w,saveSubcategories:async()=>{v(!0);try{console.log("Saving subcategories to MongoDB..."),await Me(s),console.log("Subcategories saved successfully"),S(!1),b({title:"Success",description:"Subcategories saved to database successfully"})}catch(d){console.error("Error saving subcategories:",d),b({title:"Error saving subcategories",description:"There was a problem saving the subcategories to the database.",variant:"destructive"})}finally{v(!1)}},handleAddSubcategory:async()=>{if(!r.trim()){b({title:"Error",description:"Subcategory name is required",variant:"destructive"});return}if(!i){b({title:"Error",description:"Please select a category",variant:"destructive"});return}try{v(!0),console.log("=== Adding new subcategory ==="),console.log("Form data:",{name:r,categoryId:i,selectedServices:c});const x={id:l||r.toLowerCase().replace(/\s+/g,"-"),name:r,categoryId:i,serviceIds:c};if(console.log("Generated subcategory data:",x),l)console.log("Updating existing subcategory:",x),a(s.map(A=>A.id===l?x:A));else{console.log("Adding new subcategory:",x),a([...s,x]);try{await ls(x),console.log("Subcategory created in database:",x.id)}catch(A){throw console.error("Error creating subcategory in database:",A),a(s.filter(E=>E.id!==x.id)),A}}t(""),n(""),o([]),j(null),S(!0),b({title:l?"Subcategory updated":"Subcategory added",description:`The subcategory has been ${l?"updated":"added"} successfully.`})}catch(d){console.error("Error adding/updating subcategory:",d),b({title:"Error",description:d instanceof Error?d.message:"There was a problem with the subcategory operation",variant:"destructive"})}finally{v(!1)}},handleDeleteSubcategory:async d=>{if(window.confirm("Are you sure you want to delete this subcategory?"))try{v(!0),a(s.filter(x=>x.id!==d)),await ds(d),S(!0),b({title:"Subcategory deleted",description:"The subcategory has been deleted successfully."})}catch(x){console.error(`Error deleting subcategory ${d}:`,x),s.find(E=>E.id===d)&&a([...s]),b({title:"Error deleting subcategory",description:x instanceof Error?x.message:"There was a problem deleting the subcategory.",variant:"destructive"})}finally{v(!1)}},handleServiceSelection:d=>{c.includes(d)?o(c.filter(x=>x!==d)):o([...c,d])}}}function hs(){const[s,a]=u.useState([]),[r,t]=u.useState(""),[i,n]=u.useState(""),[c,o]=u.useState(""),[l,j]=u.useState(""),[g,v]=u.useState(""),[h,S]=u.useState(!1),[b,w]=u.useState(""),[p,f]=u.useState(""),[F,R]=u.useState([]),[d,x]=u.useState(""),[A,E]=u.useState(""),[Q,_]=u.useState([]),[V,se]=u.useState(""),[te,ae]=u.useState(""),[U,ne]=u.useState(""),[k,ce]=u.useState(""),[P,re]=u.useState(""),[J,ie]=u.useState([]),[q,le]=u.useState(null),[z,de]=u.useState("basic"),[ue,M]=u.useState(!1),[me,oe]=u.useState(!1),{toast:O}=xe();u.useEffect(()=>{K()},[]);const K=async()=>{M(!0);try{const C=await Ge();a(C)}catch(C){console.error("Error loading services:",C),O({title:"Error loading services",description:"There was a problem loading the services.",variant:"destructive"})}finally{M(!1)}},m=async()=>{const C=[];if(r.trim()?/^[a-z0-9-]+$/.test(r)?s.some(X=>X.id===r&&X.id!==q)&&C.push("A service with this ID already exists"):C.push("Service ID must contain only lowercase letters, numbers, and hyphens"):C.push("Service ID is required"),i.trim()||C.push("Service title is required"),l.trim()||C.push("Service description is required"),P||C.push("Please select a category"),c.trim()||C.push("Service icon (emoji) is required"),Q.length===0&&C.push("At least one process is required"),F.length===0&&C.push("At least one FAQ is required"),(!U.trim()||!k.trim())&&C.push("Both phone and email contact information are required"),C.length>0){O({title:"Missing Information",description:C.join(`
`),variant:"destructive"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(k)){O({title:"Invalid Email",description:"Please enter a valid email address",variant:"destructive"});return}M(!0);try{const D=g.split(",").map(L=>L.trim()).filter(Boolean),T=b.split(",").map(L=>L.trim()).filter(Boolean),X=p.split(",").map(L=>L.trim()).filter(Boolean),ke={id:q||r,title:i.trim(),icon:c.trim(),description:l.trim(),features:D,category:P,selectedCategory:P,subcategoryIds:J.length>0?J:void 0,popular:h,eligibility:T,process:Q,documents:X,faqs:F,contactInfo:{phone:U.trim(),email:k.trim()}};if(q){const L=await fetch(`/api/services/${q}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ke)});if(!L.ok)throw new Error("Failed to update service");const be=await L.json();a(s.map(De=>De.id===q?be:De)),O({title:"Service updated",description:"The service has been updated successfully."})}else{const L=await fetch("/api/services",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ke)});if(!L.ok)throw new Error("Failed to add service");const be=await L.json();a([...s,be]),O({title:"Service added",description:"The service has been added successfully."})}he(),oe(!0),le(null)}catch(D){console.error("Error saving service:",D),O({title:"Error saving service",description:D instanceof Error?D.message:"Failed to save service",variant:"destructive"})}finally{M(!1)}},he=()=>{t(""),n(""),o(""),j(""),v(""),S(!1),w(""),f(""),_([]),R([]),ne(""),ce(""),re(""),ie([]),de("basic")};return{services:s,setServices:a,serviceId:r,setServiceId:t,serviceTitle:i,setServiceTitle:n,serviceIcon:c,setServiceIcon:o,serviceDescription:l,setServiceDescription:j,serviceFeatures:g,setServiceFeatures:v,servicePopular:h,setServicePopular:S,serviceEligibility:b,setServiceEligibility:w,serviceDocuments:p,setServiceDocuments:f,serviceFaqs:F,setServiceFaqs:R,faqQuestion:d,setFaqQuestion:x,faqAnswer:A,setFaqAnswer:E,serviceProcess:Q,setServiceProcess:_,processTitle:V,setProcessTitle:se,processSteps:te,setProcessSteps:ae,contactPhone:U,setContactPhone:ne,contactEmail:k,setContactEmail:ce,selectedCategory:P,setSelectedCategory:re,selectedSubcategoriesForService:J,setSelectedSubcategoriesForService:ie,editServiceId:q,setEditServiceId:le,activeServiceSection:z,setActiveServiceSection:de,isLoading:ue,hasChanges:me,setHasChanges:oe,fetchServices:K,handleAddService:m,handleDeleteService:async C=>{if(window.confirm("Are you sure you want to delete this service?"))try{M(!0),a(s.filter(y=>y.id!==C)),await fetch(`/api/services/${C}`,{method:"DELETE"}),oe(!0),O({title:"Service deleted",description:"The service has been deleted successfully."})}catch(y){console.error(`Error deleting service ${C}:`,y),s.find(T=>T.id===C)&&a([...s]),O({title:"Error deleting service",description:y instanceof Error?y.message:"Failed to delete service",variant:"destructive"})}finally{M(!1)}},resetServiceForm:he}}var gs="Separator",Te="horizontal",ms=["horizontal","vertical"],Ue=u.forwardRef((s,a)=>{const{decorative:r,orientation:t=Te,...i}=s,n=ps(t)?t:Te,o=r?{role:"none"}:{"aria-orientation":n==="vertical"?n:void 0,role:"separator"};return e.jsx(Ae.div,{"data-orientation":n,...o,...i,ref:a})});Ue.displayName=gs;function ps(s){return ms.includes(s)}var Je=Ue;const we=u.forwardRef(({className:s,orientation:a="horizontal",decorative:r=!0,...t},i)=>e.jsx(Je,{ref:i,decorative:r,orientation:a,className:Ne("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...t}));we.displayName=Je.displayName;function fs({categoryName:s,setCategoryName:a,categoryIcon:r,setCategoryIcon:t,categoryNumber:i,setCategoryNumber:n,categoryTags:c,setCategoryTags:o,editCategoryId:l,onAddCategory:j,onCancelEdit:g,isLoading:v=!1}){const[h,S]=u.useState(""),b=p=>{p.key==="Enter"&&h.trim()&&(p.preventDefault(),c.includes(h.trim())||o([...c,h.trim()]),S(""))},w=p=>{o(c.filter(f=>f!==p))};return e.jsxs(Z,{className:"w-full",children:[e.jsx(ve,{children:e.jsx(ye,{children:l?"Edit Category":"Add New Category"})}),e.jsx(ee,{children:e.jsxs("form",{onSubmit:p=>{p.preventDefault(),j()},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"categoryName",className:"text-sm font-medium",children:"Category Name *"}),e.jsx(B,{id:"categoryName",value:s,onChange:p=>a(p.target.value),placeholder:"e.g., Insurance",required:!0,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"categoryIcon",className:"text-sm font-medium",children:"Icon (emoji)"}),e.jsx(B,{id:"categoryIcon",value:r,onChange:p=>t(p.target.value),placeholder:"e.g., ðŸ”’",className:"w-full"})]})]})]}),e.jsx(we,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Display Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"categoryNumber",className:"text-sm font-medium",children:"Display Order"}),e.jsx(B,{id:"categoryNumber",type:"number",value:i,onChange:p=>n(parseInt(p.target.value)||0),placeholder:"0",className:"w-full md:w-1/3"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter a number to control display order (lower numbers appear first)"})]})]}),e.jsx(we,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Tags"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map((p,f)=>e.jsxs(Ce,{variant:"secondary",className:"flex items-center gap-1 px-3 py-1",children:[p,e.jsx("button",{type:"button",onClick:()=>w(p),className:"hover:text-destructive focus:outline-none ml-2",children:e.jsx(We,{className:"h-3 w-3"})})]},f))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"categoryTags",className:"text-sm font-medium",children:"Add Tags"}),e.jsx(B,{id:"categoryTags",value:h,onChange:p=>S(p.target.value),onKeyDown:b,placeholder:"Type a tag and press Enter",className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add tags to help organize and filter categories (optional)"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(I,{type:"submit",disabled:v||!s.trim(),className:"px-8",children:v?"Processing...":l?"Update Category":"Add Category"}),l&&e.jsx(I,{type:"button",variant:"outline",onClick:g,className:"px-8",children:"Cancel"})]})]})})]})}function xs({category:s,subcategories:a,onEdit:r,onDelete:t}){const i=a.filter(n=>n.categoryId===s.id);return e.jsx(Z,{children:e.jsxs(ee,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:s.icon}),e.jsx("h3",{className:"text-lg font-semibold",children:s.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",size:"sm",onClick:()=>r(s),children:"Edit"}),e.jsx(I,{variant:"destructive",size:"sm",onClick:()=>t(s.id),children:"Delete"})]})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:s.tags.map((n,c)=>e.jsx(Ce,{variant:"secondary",children:n},c))}),i.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Subcategories:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(n=>e.jsx(Ce,{variant:"outline",children:n.name},n.id))})]})]})})}function vs({categories:s,subcategories:a,categoryName:r,setCategoryName:t,categoryIcon:i,setCategoryIcon:n,categoryNumber:c,setCategoryNumber:o,categoryTags:l,setCategoryTags:j,editCategoryId:g,setEditCategoryId:v,onAddCategory:h,onDeleteCategory:S,isLoading:b}){const w=f=>{t(f.name),n(f.icon),o(f.number||0),j(f.tags||[]),v(f.id)},p=()=>{v(null),t(""),n(""),o(0),j([])};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-8",children:e.jsx(fs,{categoryName:r,setCategoryName:t,categoryIcon:i,setCategoryIcon:n,categoryNumber:c,setCategoryNumber:o,categoryTags:l,setCategoryTags:j,editCategoryId:g,onAddCategory:h,onCancelEdit:p,isLoading:b})}),e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Existing Categories"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Array.isArray(s)&&s.length>0?s.map(f=>e.jsx(xs,{category:f,subcategories:a,onEdit:w,onDelete:S},f.id)):e.jsx("div",{className:"col-span-3 text-center p-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No categories found. Add a new category to get started."})})})]})}var Ie="Checkbox",[ys,Ms]=Ye(Ie),[js,bs]=ys(Ie),He=u.forwardRef((s,a)=>{const{__scopeCheckbox:r,name:t,checked:i,defaultChecked:n,required:c,disabled:o,value:l="on",onCheckedChange:j,form:g,...v}=s,[h,S]=u.useState(null),b=Ze(a,d=>S(d)),w=u.useRef(!1),p=h?g||!!h.closest("form"):!0,[f=!1,F]=es({prop:i,defaultProp:n,onChange:j}),R=u.useRef(f);return u.useEffect(()=>{const d=h==null?void 0:h.form;if(d){const x=()=>F(R.current);return d.addEventListener("reset",x),()=>d.removeEventListener("reset",x)}},[h,F]),e.jsxs(js,{scope:r,state:f,disabled:o,children:[e.jsx(Ae.button,{type:"button",role:"checkbox","aria-checked":Y(f)?"mixed":f,"aria-required":c,"data-state":Ve(f),"data-disabled":o?"":void 0,disabled:o,value:l,...v,ref:b,onKeyDown:Pe(s.onKeyDown,d=>{d.key==="Enter"&&d.preventDefault()}),onClick:Pe(s.onClick,d=>{F(x=>Y(x)?!0:!x),p&&(w.current=d.isPropagationStopped(),w.current||d.stopPropagation())})}),p&&e.jsx(Ss,{control:h,bubbles:!w.current,name:t,value:l,checked:f,required:c,disabled:o,form:g,style:{transform:"translateX(-100%)"},defaultChecked:Y(n)?!1:n})]})});He.displayName=Ie;var Qe="CheckboxIndicator",_e=u.forwardRef((s,a)=>{const{__scopeCheckbox:r,forceMount:t,...i}=s,n=bs(Qe,r);return e.jsx(ss,{present:t||Y(n.state)||n.state===!0,children:e.jsx(Ae.span,{"data-state":Ve(n.state),"data-disabled":n.disabled?"":void 0,...i,ref:a,style:{pointerEvents:"none",...s.style}})})});_e.displayName=Qe;var Ss=s=>{const{control:a,checked:r,bubbles:t=!0,defaultChecked:i,...n}=s,c=u.useRef(null),o=ts(r),l=as(a);u.useEffect(()=>{const g=c.current,v=window.HTMLInputElement.prototype,S=Object.getOwnPropertyDescriptor(v,"checked").set;if(o!==r&&S){const b=new Event("click",{bubbles:t});g.indeterminate=Y(r),S.call(g,Y(r)?!1:r),g.dispatchEvent(b)}},[o,r,t]);const j=u.useRef(Y(r)?!1:r);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i??j.current,...n,tabIndex:-1,ref:c,style:{...s.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Y(s){return s==="indeterminate"}function Ve(s){return Y(s)?"indeterminate":s?"checked":"unchecked"}var Ke=He,Ns=_e;const fe=u.forwardRef(({className:s,...a},r)=>e.jsx(Ke,{ref:r,className:Ne("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:e.jsx(Ns,{className:Ne("flex items-center justify-center text-current"),children:e.jsx(rs,{className:"h-4 w-4"})})}));fe.displayName=Ke.displayName;function Cs({subcategoryName:s,setSubcategoryName:a,selectedCategory:r,setSelectedCategory:t,selectedServices:i,onServiceSelection:n,categories:c,services:o,editSubcategoryId:l,onAddSubcategory:j,onCancelEdit:g,isLoading:v=!1}){return e.jsxs(Z,{children:[e.jsx(ve,{children:e.jsx(ye,{children:l?"Edit Subcategory":"Add New Subcategory"})}),e.jsx(ee,{children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"subcategoryName",children:"Subcategory Name"}),e.jsx(B,{id:"subcategoryName",value:s,onChange:h=>a(h.target.value),placeholder:"e.g., Corporate Law"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"subcategoryCategory",children:"Category"}),e.jsxs($e,{value:r,onValueChange:t,children:[e.jsx(Re,{id:"subcategoryCategory",children:e.jsx(qe,{placeholder:"Select a category"})}),e.jsx(Oe,{children:c.map(h=>e.jsxs(Be,{value:h.id,children:[h.icon," ",h.name]},h.id))})]})]})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Services Linked"}),e.jsx("div",{className:"border rounded p-3 max-h-60 overflow-y-auto mt-2",children:o.map(h=>e.jsxs("div",{className:"flex items-center space-x-2 py-2",children:[e.jsx(fe,{id:`service-${h.id}`,checked:i.includes(h.id),onCheckedChange:()=>n(h.id)}),e.jsx(N,{htmlFor:`service-${h.id}`,className:"cursor-pointer",children:h.title})]},h.id))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{onClick:j,disabled:v,children:v?"Processing...":l?"Update Subcategory":"Add Subcategory"}),l&&e.jsx(I,{variant:"outline",onClick:g,children:"Cancel"})]})]})})]})}function ws({subcategory:s,categories:a,services:r,onEdit:t,onDelete:i}){var n;return e.jsx(Z,{children:e.jsxs(ee,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:s.name}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["ID: ",s.id]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Category: ",((n=a.find(c=>c.id===s.categoryId))==null?void 0:n.name)||s.categoryId]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Linked Services:"}),e.jsx("ul",{className:"list-disc list-inside text-sm",children:s.serviceIds.map(c=>{var o;return e.jsx("li",{children:((o=r.find(l=>l.id===c))==null?void 0:o.title)||c},c)})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(I,{variant:"outline",onClick:()=>t(s),children:"Edit"}),e.jsx(I,{variant:"destructive",onClick:()=>i(s.id),children:"Delete"})]})]})},s.id)}function Es({subcategories:s,categories:a,services:r,subcategoryName:t,setSubcategoryName:i,selectedCategory:n,setSelectedCategory:c,selectedServices:o,setSelectedServices:l,editSubcategoryId:j,setEditSubcategoryId:g,onAddSubcategory:v,onDeleteSubcategory:h,isLoading:S}){const b=f=>{i(f.name),c(f.categoryId),l(f.serviceIds),g(f.id)},w=()=>{g(null),i(""),c(""),l([])},p=f=>{o.includes(f)?l(o.filter(F=>F!==f)):l([...o,f])};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-8",children:e.jsx(Cs,{subcategoryName:t,setSubcategoryName:i,selectedCategory:n,setSelectedCategory:c,selectedServices:o,onServiceSelection:p,categories:a,services:r,editSubcategoryId:j,onAddSubcategory:v,onCancelEdit:w,isLoading:S})}),e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Existing Subcategories"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:s.length>0?s.map(f=>e.jsx(ws,{subcategory:f,categories:a,services:r,onEdit:b,onDelete:h},f.id)):e.jsx("div",{className:"col-span-3 text-center p-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No subcategories found. Add a new subcategory to get started."})})})]})}function As({faqs:s,faqQuestion:a,setFaqQuestion:r,faqAnswer:t,setFaqAnswer:i,onAddFaq:n,onRemoveFaq:c}){return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"faqQuestion",children:"Question"}),e.jsx(B,{id:"faqQuestion",value:a,onChange:o=>r(o.target.value),placeholder:"e.g., How long does the process take?"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"faqAnswer",children:"Answer"}),e.jsx(ge,{id:"faqAnswer",value:t,onChange:o=>i(o.target.value),placeholder:"Provide a detailed answer...",rows:3})]}),e.jsx(I,{onClick:n,variant:"outline",children:"Add FAQ"}),s.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"FAQs"}),e.jsx("div",{className:"space-y-4",children:s.map((o,l)=>e.jsx(Z,{children:e.jsxs(ee,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-semibold",children:o.question}),e.jsx(I,{variant:"destructive",size:"sm",onClick:()=>c(l),children:"Remove"})]}),e.jsx("p",{className:"text-sm",children:o.answer})]})},l))})]})]})}function Is({processes:s,processTitle:a,setProcessTitle:r,processSteps:t,setProcessSteps:i,onAddProcess:n,onRemoveProcess:c}){return e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(N,{htmlFor:"processTitle",children:"Process Phase Title"}),e.jsx(B,{id:"processTitle",value:a,onChange:o=>r(o.target.value),placeholder:"e.g., Initial Assessment"})]})}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"processSteps",children:"Process Steps (comma-separated)"}),e.jsx(ge,{id:"processSteps",value:t,onChange:o=>i(o.target.value),placeholder:"Step 1, Step 2, Step 3...",rows:3})]}),e.jsx(I,{onClick:n,variant:"outline",children:"Add Process Phase"}),s.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Process Phases"}),e.jsx("div",{className:"space-y-4",children:s.map((o,l)=>e.jsx(Z,{children:e.jsxs(ee,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-semibold",children:o.title}),e.jsx(I,{variant:"destructive",size:"sm",onClick:()=>c(l),children:"Remove"})]}),e.jsx("ul",{className:"list-disc list-inside",children:o.steps.map((j,g)=>e.jsx("li",{children:j},g))})]})},l))})]})]})}function Fs({serviceId:s,setServiceId:a,serviceTitle:r,setServiceTitle:t,serviceIcon:i,setServiceIcon:n,serviceDescription:c,setServiceDescription:o,serviceFeatures:l,setServiceFeatures:j,servicePopular:g,setServicePopular:v,serviceEligibility:h,setServiceEligibility:S,serviceDocuments:b,setServiceDocuments:w,serviceFaqs:p,setServiceFaqs:f,faqQuestion:F,setFaqQuestion:R,faqAnswer:d,setFaqAnswer:x,serviceProcess:A,setServiceProcess:E,processTitle:Q,setProcessTitle:_,processSteps:V,setProcessSteps:se,contactPhone:te,setContactPhone:ae,contactEmail:U,setContactEmail:ne,selectedCategory:k,setSelectedCategory:ce,selectedSubcategories:P,setSelectedSubcategories:re,categories:J,subcategories:ie,activeSection:q,setActiveSection:le,editServiceId:z,onAddService:de,onCancelEdit:ue,onAddFaq:M,onRemoveFaq:me,onAddProcess:oe,onRemoveProcess:O,isLoading:K=!1}){return e.jsxs(Z,{children:[e.jsx(ve,{children:e.jsx(ye,{children:z?"Edit Service":"Add New Service"})}),e.jsxs(ee,{children:[e.jsxs(Le,{value:q,onValueChange:le,children:[e.jsxs(ze,{className:"mb-4",children:[e.jsx(G,{value:"basic",children:"Basic Info"}),e.jsx(G,{value:"eligibility",children:"Eligibility & Documents"}),e.jsx(G,{value:"process",children:"Process"}),e.jsx(G,{value:"faqs",children:"FAQs"}),e.jsx(G,{value:"contact",children:"Contact"})]}),e.jsx(W,{value:"basic",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"serviceId",children:"Service ID"}),e.jsx(B,{id:"serviceId",value:s,onChange:m=>a(m.target.value),placeholder:"e.g., health-claim"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"serviceTitle",children:"Title"}),e.jsx(B,{id:"serviceTitle",value:r,onChange:m=>t(m.target.value),placeholder:"e.g., Health Insurance Claim"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"serviceIcon",children:"Icon (emoji)"}),e.jsx(B,{id:"serviceIcon",value:i,onChange:m=>n(m.target.value),placeholder:"e.g., ðŸ¥"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"serviceCategory",children:"Category"}),e.jsxs($e,{value:k,onValueChange:ce,children:[e.jsx(Re,{children:e.jsx(qe,{placeholder:"Select a category"})}),e.jsx(Oe,{children:J.map(m=>e.jsxs(Be,{value:m.id,children:[m.icon," ",m.name]},m.id))})]})]})]}),e.jsxs("div",{className:"grid gap-3 mt-4",children:[e.jsx(N,{htmlFor:"serviceSubcategories",children:"Subcategories (Optional)"}),e.jsxs("div",{className:"border rounded p-3 max-h-60 overflow-y-auto",children:[k?ie.filter(m=>m.categoryId===k).map(m=>e.jsxs("div",{className:"flex items-center space-x-2 py-2",children:[e.jsx(fe,{id:`subcategory-${m.id}`,checked:P.includes(m.id),onCheckedChange:()=>{P.includes(m.id)?re(P.filter(he=>he!==m.id)):re([...P,m.id])}}),e.jsx(N,{htmlFor:`subcategory-${m.id}`,className:"text-sm font-medium leading-none cursor-pointer",children:m.name})]},m.id)):e.jsx("p",{className:"text-sm text-muted-foreground p-2",children:"Please select a category first to see available subcategories"}),k&&ie.filter(m=>m.categoryId===k).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground p-2",children:"No subcategories available for this category"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Note: It's not necessary for a service to have a subcategory"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fe,{id:"servicePopular",checked:g,onCheckedChange:m=>v(m===!0)}),e.jsx(N,{htmlFor:"servicePopular",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Mark as popular service (will appear in the Popular Services section)"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"serviceDescription",children:"Description"}),e.jsx(ge,{id:"serviceDescription",value:c,onChange:m=>o(m.target.value),placeholder:"Describe the service...",rows:3})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"serviceFeatures",children:"Features (comma-separated)"}),e.jsx(ge,{id:"serviceFeatures",value:l,onChange:m=>j(m.target.value),placeholder:"Feature 1, Feature 2, Feature 3...",rows:3})]})]})}),e.jsx(W,{value:"eligibility",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"serviceEligibility",children:"Eligibility Criteria"}),e.jsx(ge,{id:"serviceEligibility",value:h,onChange:m=>S(m.target.value),placeholder:"Enter eligibility criteria...",rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter the eligibility criteria as you want it to appear on the service page."})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"serviceDocuments",children:"Required Documents"}),e.jsx(ge,{id:"serviceDocuments",value:b,onChange:m=>w(m.target.value),placeholder:"Enter required documents...",rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter the required documents as you want them to appear on the service page."})]})]})}),e.jsx(W,{value:"process",children:e.jsx(Is,{processes:A,processTitle:Q,setProcessTitle:_,processSteps:V,setProcessSteps:se,onAddProcess:oe,onRemoveProcess:O})}),e.jsx(W,{value:"faqs",children:e.jsx(As,{faqs:p,faqQuestion:F,setFaqQuestion:R,faqAnswer:d,setFaqAnswer:x,onAddFaq:M,onRemoveFaq:me})}),e.jsx(W,{value:"contact",children:e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"contactPhone",children:"Phone Number"}),e.jsx(B,{id:"contactPhone",value:te,onChange:m=>ae(m.target.value),placeholder:"e.g., +1 (800) 123-4567"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"contactEmail",children:"Email Address"}),e.jsx(B,{id:"contactEmail",value:U,onChange:m=>ne(m.target.value),placeholder:"e.g., service@example.com"})]})]})})})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(I,{onClick:de,disabled:K,className:"min-w-[120px]",children:K?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),z?"Updating...":"Adding..."]}):z?"Update Service":"Add Service"}),z&&e.jsx(I,{variant:"outline",onClick:ue,disabled:K,children:"Cancel"})]})]})]})}function ks({service:s,categories:a,subcategories:r,onEdit:t,onDelete:i,isLoading:n=!1}){var j;const[c,o]=u.useState(!1),l=async()=>{if(window.confirm("Are you sure you want to delete this service?")){o(!0);try{await i(s.id)}finally{o(!1)}}};return e.jsxs(Z,{children:[e.jsx(ve,{children:e.jsxs(ye,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.icon}),s.title]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",size:"sm",onClick:()=>t(s),disabled:n||c,children:"Edit"}),e.jsx(I,{variant:"destructive",size:"sm",onClick:l,disabled:n||c,children:c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Deleting..."]}):"Delete"})]})]})}),e.jsxs(ee,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["ID: ",s.id]}),s.category&&e.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-1 rounded-full",children:((j=a.find(g=>g.id===s.category))==null?void 0:j.name)||s.category}),s.popular&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:"Popular"})]}),s.subcategoryIds&&s.subcategoryIds.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"Subcategories: "}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.subcategoryIds.map(g=>{const v=r.find(h=>h.id===g);return e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:(v==null?void 0:v.name)||g},g)})})]}),e.jsx("p",{className:"text-sm mb-4 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-1 mb-4",children:[s.eligibility&&s.eligibility.length>0&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:[s.eligibility.length," eligibility criteria"]}),s.process&&s.process.length>0&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:[s.process.length," process phases"]}),s.documents&&s.documents.length>0&&e.jsxs("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:[s.documents.length," documents"]}),s.faqs&&s.faqs.length>0&&e.jsxs("span",{className:"text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full",children:[s.faqs.length," FAQs"]})]})]})]},s.id)}function Ds({services:s,categories:a,subcategories:r,serviceId:t,setServiceId:i,serviceTitle:n,setServiceTitle:c,serviceIcon:o,setServiceIcon:l,serviceDescription:j,setServiceDescription:g,serviceFeatures:v,setServiceFeatures:h,servicePopular:S,setServicePopular:b,serviceEligibility:w,setServiceEligibility:p,serviceDocuments:f,setServiceDocuments:F,serviceFaqs:R,setServiceFaqs:d,faqQuestion:x,setFaqQuestion:A,faqAnswer:E,setFaqAnswer:Q,serviceProcess:_,setServiceProcess:V,processTitle:se,setProcessTitle:te,processSteps:ae,setProcessSteps:U,contactPhone:ne,setContactPhone:k,contactEmail:ce,setContactEmail:P,selectedCategory:re,setSelectedCategory:J,selectedSubcategories:ie,setSelectedSubcategories:q,activeServiceSection:le,setActiveServiceSection:z,editServiceId:de,setEditServiceId:ue,onAddService:M,onDeleteService:me,isLoading:oe}){const O=y=>{var D,T;if(i(y.id),c(y.title),l(y.icon),g(y.description),h(Array.isArray(y.features)?y.features.join(", "):""),b(y.popular||!1),J(y.category||""),q(y.subcategoryIds||[]),p(Array.isArray(y.eligibility)?y.eligibility.join(", "):""),F(Array.isArray(y.documents)?y.documents.join(", "):""),y.process&&y.process.length>0){const X=y.process[0];te(X.title||""),U(Array.isArray(X.steps)?X.steps.join(", "):"")}d(y.faqs||[]),k(((D=y.contactInfo)==null?void 0:D.phone)||""),P(((T=y.contactInfo)==null?void 0:T.email)||""),ue(y.id),z("basic")},K=()=>{ue(null),i(""),c(""),l(""),g(""),h(""),b(!1),p(""),F(""),V([]),d([]),k(""),P(""),J(""),q([]),z("basic")},m=()=>{x&&E&&(d([...R,{question:x,answer:E}]),A(""),Q(""))},he=y=>{d(R.filter((D,T)=>T!==y))},Fe=()=>{if(se&&ae){const y=ae.split(",").map(T=>T.trim()).filter(Boolean),D={title:se,steps:y};V([..._,D]),te(""),U("")}},C=y=>{V(_.filter((D,T)=>T!==y))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-8",children:e.jsx(Fs,{serviceId:t,setServiceId:i,serviceTitle:n,setServiceTitle:c,serviceIcon:o,setServiceIcon:l,serviceDescription:j,setServiceDescription:g,serviceFeatures:v,setServiceFeatures:h,servicePopular:S,setServicePopular:b,serviceEligibility:w,setServiceEligibility:p,serviceDocuments:f,setServiceDocuments:F,serviceFaqs:R,setServiceFaqs:d,faqQuestion:x,setFaqQuestion:A,faqAnswer:E,setFaqAnswer:Q,serviceProcess:_,setServiceProcess:V,processTitle:se,setProcessTitle:te,processSteps:ae,setProcessSteps:U,contactPhone:ne,setContactPhone:k,contactEmail:ce,setContactEmail:P,selectedCategory:re,setSelectedCategory:J,selectedSubcategories:ie,setSelectedSubcategories:q,categories:a,subcategories:r,activeSection:le,setActiveSection:z,editServiceId:de,onAddService:M,onCancelEdit:K,onAddFaq:m,onRemoveFaq:he,onAddProcess:Fe,onRemoveProcess:C,isLoading:oe})}),e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Existing Services"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:s.length>0?s.map(y=>e.jsx(ks,{service:y,categories:a,subcategories:r,onEdit:O,onDelete:me},y.id)):e.jsx("div",{className:"col-span-3 text-center p-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No services found. Add a new service to get started."})})})]})}let H=[],Se=!1,Ee=0;const Ps=5*60*1e3;let Ts=[];function $s(s){let a=s.icon;if(!a){const t=s.name.toLowerCase();t.includes("insurance")?a="ðŸ”’":t.includes("debt")||t.includes("loan")?a="ðŸ’°":t.includes("consumer")||t.includes("dispute")?a="ðŸ›’":t.includes("trademark")||t.includes("ip")?a="â„¢ï¸":t.includes("business")||t.includes("ngo")?a="ðŸ¢":t.includes("property")||t.includes("personal")?a="ðŸ ":a="ðŸ“„"}return{id:s.id||s.name.replace(/\s+/g,"-").toLowerCase(),name:s.name,icon:a,number:s.number!==void 0?s.number:0,tags:s.tags||[]}}async function Rs(){try{const s=await fetch("/api/categories");if(!s.ok)throw new Error(`Failed to fetch categories: ${s.statusText}`);return(await s.json()).map($s)}catch(s){return console.error("Error fetching categories:",s),[]}}async function qs(){const s=Date.now();if(H.length>0&&s-Ee<Ps)return[...H];if(Se)return H.length>0?[...H]:[];Se=!0;try{const a=await Rs();return H=a,Ee=s,Xe(),[...a]}catch(a){return console.error("Error in getAllCategories:",a),H.length>0?[...H]:[]}finally{Se=!1}}async function Os(s){try{console.log("Updating categories in database:",s),console.log("Clearing existing categories...");const a=await fetch("/api/categories/clear",{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok){const r=await a.json();throw new Error(`Failed to clear categories: ${r.error||a.statusText}`)}console.log("Categories cleared successfully");for(const r of s){console.log(`Adding category: ${r.name}`);const t=await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r.id,name:r.name,icon:r.icon,number:r.number||0,tags:r.tags||[]})});if(!t.ok){const i=await t.json();throw new Error(`Failed to save category ${r.name}: ${i.error||t.statusText}`)}console.log(`Category ${r.name} added successfully`)}H=[...s],Ee=Date.now();try{localStorage.setItem("categories",JSON.stringify(s))}catch(r){console.error("Failed to save categories to localStorage:",r)}Xe(),console.log("Categories update completed successfully")}catch(a){throw console.error("Error updating categories in database:",a),a}}function Xe(){Ts.forEach(s=>s())}try{const s=localStorage.getItem("categories");s&&(H=JSON.parse(s))}catch(s){console.error("Failed to load categories from localStorage:",s)}qs().catch(console.error);function Us(){const{toast:s}=xe(),a=os(),r=us(),t=hs(),[i,n]=u.useState(!1),c=a.hasChanges||r.hasChanges||t.hasChanges;u.useEffect(()=>{(async()=>{try{await Promise.all([a.fetchCategories(),r.fetchSubcategories(),t.fetchServices()])}catch(j){console.error("Error fetching initial data:",j),s({title:"Error",description:"Failed to load initial data",variant:"destructive"})}})()},[]);const o=async()=>{n(!0);try{const l=[];t.hasChanges&&(console.log("Saving services changes to MongoDB..."),l.push(is(t.services))),a.hasChanges&&(console.log("Saving categories changes to MongoDB..."),l.push(Os(a.categories))),r.hasChanges&&(console.log("Saving subcategories changes to MongoDB..."),l.push(Me(r.subcategories))),await Promise.all(l),s({title:"Changes saved",description:"All changes have been saved to the database and will be reflected on the home screen and service pages."}),a.setHasChanges(!1),r.setHasChanges(!1),t.setHasChanges(!1),await Promise.all([a.fetchCategories(),r.fetchSubcategories(),t.fetchServices()])}catch(l){console.error("Error saving changes:",l),s({title:"Error saving changes",description:"An error occurred while saving your changes to the database.",variant:"destructive"})}finally{n(!1)}};return e.jsxs("div",{className:"container mx-auto py-10 px-4",children:[e.jsx("div",{className:"flex flex-col mb-8",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),c&&e.jsx(I,{onClick:o,className:"bg-green-600 hover:bg-green-700",disabled:i,children:i?"Saving...":"Save All Changes"})]})}),e.jsxs(Le,{defaultValue:"categories",children:[e.jsxs(ze,{className:"mb-8",children:[e.jsx(G,{value:"categories",children:"Categories"}),e.jsx(G,{value:"subcategories",children:"Subcategories"}),e.jsx(G,{value:"services",children:"Services"})]}),e.jsx(W,{value:"categories",children:e.jsx(vs,{categories:a.categories,subcategories:r.subcategories,categoryName:a.categoryName,setCategoryName:a.setCategoryName,categoryIcon:a.categoryIcon,setCategoryIcon:a.setCategoryIcon,categoryNumber:a.categoryNumber,setCategoryNumber:a.setCategoryNumber,categoryTags:a.categoryTags,setCategoryTags:a.setCategoryTags,editCategoryId:a.editCategoryId,setEditCategoryId:a.setEditCategoryId,onAddCategory:a.handleAddCategory,onDeleteCategory:a.handleDeleteCategory,isLoading:a.isLoading})}),e.jsx(W,{value:"subcategories",children:e.jsx(Es,{subcategories:r.subcategories,categories:a.categories,services:t.services,subcategoryName:r.subcategoryName,setSubcategoryName:r.setSubcategoryName,selectedCategory:r.selectedCategoryForSubcategory,setSelectedCategory:r.setSelectedCategoryForSubcategory,selectedServices:r.selectedServicesForSubcategory,setSelectedServices:r.setSelectedServicesForSubcategory,editSubcategoryId:r.editSubcategoryId,setEditSubcategoryId:r.setEditSubcategoryId,onAddSubcategory:r.handleAddSubcategory,onDeleteSubcategory:r.handleDeleteSubcategory,isLoading:r.isLoading})}),e.jsx(W,{value:"services",children:e.jsx(Ds,{services:t.services,categories:a.categories,subcategories:r.subcategories,serviceId:t.serviceId,setServiceId:t.setServiceId,serviceTitle:t.serviceTitle,setServiceTitle:t.setServiceTitle,serviceIcon:t.serviceIcon,setServiceIcon:t.setServiceIcon,serviceDescription:t.serviceDescription,setServiceDescription:t.setServiceDescription,serviceFeatures:t.serviceFeatures,setServiceFeatures:t.setServiceFeatures,servicePopular:t.servicePopular,setServicePopular:t.setServicePopular,serviceEligibility:t.serviceEligibility,setServiceEligibility:t.setServiceEligibility,serviceDocuments:t.serviceDocuments,setServiceDocuments:t.setServiceDocuments,serviceFaqs:t.serviceFaqs,setServiceFaqs:t.setServiceFaqs,faqQuestion:t.faqQuestion,setFaqQuestion:t.setFaqQuestion,faqAnswer:t.faqAnswer,setFaqAnswer:t.setFaqAnswer,serviceProcess:t.serviceProcess,setServiceProcess:t.setServiceProcess,processTitle:t.processTitle,setProcessTitle:t.setProcessTitle,processSteps:t.processSteps,setProcessSteps:t.setProcessSteps,contactPhone:t.contactPhone,setContactPhone:t.setContactPhone,contactEmail:t.contactEmail,setContactEmail:t.setContactEmail,selectedCategory:t.selectedCategory,setSelectedCategory:t.setSelectedCategory,selectedSubcategories:t.selectedSubcategoriesForService,setSelectedSubcategories:t.setSelectedSubcategoriesForService,activeServiceSection:t.activeServiceSection,setActiveServiceSection:t.setActiveServiceSection,editServiceId:t.editServiceId,setEditServiceId:t.setEditServiceId,onAddService:t.handleAddService,onDeleteService:t.handleDeleteService,isLoading:t.isLoading})})]}),c&&e.jsx("div",{className:"fixed bottom-20 right-4 z-50",children:e.jsx(I,{onClick:o,size:"lg",className:"bg-green-600 hover:bg-green-700 shadow-lg",disabled:i,children:i?"Saving...":"Save All Changes"})}),e.jsx("div",{className:"mt-8 p-4 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Note:"}),` Click the "Save All Changes" button to persist your changes to the application's data. Changes will be immediately reflected on the home screen and service pages after saving. Without saving, changes will only be stored in memory and will be lost when the page is refreshed.`]})})]})}export{Us as default};
