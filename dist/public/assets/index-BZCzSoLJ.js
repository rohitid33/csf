import{c as U,af as $,a5 as B,r as t,j as e,$ as F,L as T,B as I}from"./index-B3yLkj_P.js";import{T as M,a as H,b as O,c as h,d as l,e as P,f as a}from"./table-DbxJySh8.js";import{B as R}from"./badge-4B3PkiTv.js";import{A as z,b as J,c as Q,d as V,e as q,f as G,g as K,h as W}from"./alert-dialog-D7AW1HCX.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=U("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),se=()=>{const{isAdminAuthenticated:m}=$(),{toast:j}=B(),[f,g]=t.useState([]),[D,N]=t.useState(!0),[p,v]=t.useState(null),[o,b]=t.useState(""),[C,x]=t.useState(!1),[n,y]=t.useState(null),[u,w]=t.useState(!1),S=async()=>{try{const s=localStorage.getItem("adminToken");if(!s)throw new Error("Admin authentication required. Please log in again.");const r=await fetch("/api/admin/users",{credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(!r.ok){if(r.status===401)throw localStorage.removeItem("adminToken"),new Error("Authentication expired. Please log in again.");let c=`Failed to fetch users: ${r.status} ${r.statusText}`;try{const i=await r.json();console.error("User fetch error (JSON):",i),i.message?c=`Server error: ${i.message}`:i.error&&(c=`Server error: ${i.error}`)}catch{try{const d=await r.text();console.error("User fetch error (Text):",d),d&&(c=`Server error: ${d}`)}catch{console.error("Could not parse error response")}}throw new Error(c)}const L=await r.json();g(L)}catch(s){v(s instanceof Error?s.message:"Failed to fetch users")}finally{N(!1)}};t.useEffect(()=>{m&&S()},[m]);const E=async()=>{if(n){w(!0);try{if(!(await fetch(`/api/admin/users/${n.id}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete user");g(f.filter(r=>r.id!==n.id)),j({title:"Success",description:"User deleted successfully"}),x(!1),y(null)}catch(s){j({title:"Error",description:s instanceof Error?s.message:"Failed to delete user",variant:"destructive"})}finally{w(!1)}}},A=f.filter(s=>s.username.toLowerCase().includes(o.toLowerCase())||s.email.toLowerCase().includes(o.toLowerCase())||`${s.firstName} ${s.lastName}`.toLowerCase().includes(o.toLowerCase())),k=s=>new Date(s).toLocaleDateString();return m?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"User Management"}),e.jsx(F,{placeholder:"Search users...",value:o,onChange:s=>b(s.target.value),className:"max-w-sm"})]}),p&&e.jsx("div",{className:"bg-red-100 text-red-800 p-4 rounded-lg mb-6",children:p}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(M,{children:[e.jsx(H,{children:"List of all users"}),e.jsx(O,{children:e.jsxs(h,{children:[e.jsx(l,{children:"Name"}),e.jsx(l,{children:"Username"}),e.jsx(l,{children:"Email"}),e.jsx(l,{children:"Role"}),e.jsx(l,{children:"Joined"}),e.jsx(l,{className:"text-right",children:"Actions"})]})}),e.jsx(P,{children:D?e.jsx(h,{children:e.jsx(a,{colSpan:6,className:"text-center py-10",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(T,{className:"h-6 w-6 animate-spin"})})})}):A.length===0?e.jsx(h,{children:e.jsx(a,{colSpan:6,className:"text-center py-10",children:"No users found."})}):A.map(s=>e.jsxs(h,{children:[e.jsxs(a,{children:[s.firstName," ",s.lastName]}),e.jsx(a,{children:s.username}),e.jsx(a,{children:s.email}),e.jsx(a,{children:e.jsx(R,{variant:s.isAdmin?"default":"secondary",children:s.isAdmin?"Admin":"User"})}),e.jsx(a,{children:k(s.createdAt)}),e.jsx(a,{className:"text-right",children:e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>{y(s),x(!0)},children:e.jsx(X,{className:"h-4 w-4 text-red-500"})})})]},s.id))})]})}),e.jsx(z,{open:C,onOpenChange:x,children:e.jsxs(J,{children:[e.jsxs(Q,{children:[e.jsx(V,{children:"Are you sure you want to delete this user?"}),e.jsxs(q,{children:["This action cannot be undone. This will permanently delete the user",e.jsxs("strong",{children:[" ",n==null?void 0:n.username]})," and remove all their data."]})]}),e.jsxs(G,{children:[e.jsx(K,{disabled:u,children:"Cancel"}),e.jsx(W,{onClick:E,disabled:u,className:"bg-red-600 hover:bg-red-700",children:u?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete User"})]})]})})]}):e.jsx("div",{children:"Access denied. Please log in as an admin."})};export{se as default};
